
#######################################
## Options used across builds/tests. ##
#######################################

build \
  --build_tag_filters -i386-only,-arch-only \
  --test_tag_filters -i386-only,-arch-only \
  --verbose_failures \
  --strip=never

# https://github.com/bazelbuild/bazel/issues/8195
build --incompatible_disallow_empty_glob

# https://github.com/bazelbuild/bazel/issues/10225
build --incompatible_no_implicit_file_export

# https://github.com/bazelbuild/bazel/issues/8622
# TODO: Enable once dependencies allow.
# build --incompatible_use_platforms_repo_for_constraints

# https://github.com/bazelbuild/bazel/issues/7260
# TODO: Enable once I have time.
# # build --incompatible_enable_cc_toolchain_resolution

test \
  --test_output=errors \
  --test_verbose_timeout_warnings

####################################################################
## Options for cross-compiling SmouthOS on the i386 architecture. ##
####################################################################

# Build and use local toolchain.
build:i386 \
  --build_tag_filters i386,i386-only,arch-only \
  --test_tag_filters i386,i386-only,arch-only \
  --crosstool_top=//tools/toolchain \
  --host_crosstool_top=@bazel_tools//tools/cpp:toolchain \
  --cpu=i386 \
  --compiler=g++ \
  --action_env=WORKSPACE=toolchain-i686-elf \
  --action_env=TARGET=i686-elf

# Use pre-built Linux toolchain. For use in CI.
build:i386-linux-premade \
  --crosstool_top=//tools/toolchain:linux-premade \
  --action_env=WORKSPACE=toolchain-i686-elf-linux \

# Use pre-built MacOS toolchain. For use in CI.
build:i386-darwin-premade \
  --crosstool_top=//tools/toolchain:darwin-premade \
  --action_env=WORKSPACE=toolchain-i686-elf-darwin

############################################################################
## Continuous Integration (ci) options for running SmouthOS on Travis CI. ##
############################################################################

build:ci \
  --noshow_progress \
  --noshow_loading_progress \
  --color=no
